{"ast":null,"code":"import { withIronSession } from \"next-iron-session\";\nimport data from \"../../data\";\nexport default withIronSession(async (req, res) => {\n  console.log(\"sessions hit\");\n\n  if (req.method === \"POST\") {\n    const users = await data.readTable(\"Users\");\n    const {\n      email,\n      password\n    } = req.body;\n\n    for (let i = 0; i < users.length; i++) {\n      if (users[i].email === email && users[i].passHash === password) {\n        const fName = users[i].fName;\n        req.session.set(\"user\", {\n          email,\n          fName\n        });\n        await req.session.save();\n        return res.status(201).send(\"\");\n      }\n    }\n\n    return res.status(403).send(\"\");\n  }\n\n  return res.status(404).send(\"\");\n}, {\n  cookieName: \"LOGIN\",\n  cookieOptions: {\n    secure: false ? true : false\n  },\n  password: process.env.APPLICATION_SECRET\n});","map":{"version":3,"sources":["/home/charles/serverless-next.js/packages/serverless-components/nextjs-component/examples/evote/pages/api/sessions.js"],"names":["withIronSession","data","req","res","console","log","method","users","readTable","email","password","body","i","length","passHash","fName","session","set","save","status","send","cookieName","cookieOptions","secure","process","env","APPLICATION_SECRET"],"mappings":"AAAA,SAASA,eAAT,QAAgC,mBAAhC;AACA,OAAOC,IAAP,MAAiB,YAAjB;AAEA,eAAeD,eAAe,CAC5B,OAAOE,GAAP,EAAYC,GAAZ,KAAoB;AAClBC,EAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ;;AACA,MAAIH,GAAG,CAACI,MAAJ,KAAe,MAAnB,EAA2B;AACzB,UAAMC,KAAK,GAAG,MAAMN,IAAI,CAACO,SAAL,CAAe,OAAf,CAApB;AACA,UAAM;AAAEC,MAAAA,KAAF;AAASC,MAAAA;AAAT,QAAsBR,GAAG,CAACS,IAAhC;;AAEA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,KAAK,CAACM,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACrC,UAAIL,KAAK,CAACK,CAAD,CAAL,CAASH,KAAT,KAAmBA,KAAnB,IAA4BF,KAAK,CAACK,CAAD,CAAL,CAASE,QAAT,KAAsBJ,QAAtD,EAAgE;AAC9D,cAAMK,KAAK,GAAGR,KAAK,CAACK,CAAD,CAAL,CAASG,KAAvB;AACAb,QAAAA,GAAG,CAACc,OAAJ,CAAYC,GAAZ,CAAgB,MAAhB,EAAwB;AAAER,UAAAA,KAAF;AAASM,UAAAA;AAAT,SAAxB;AACA,cAAMb,GAAG,CAACc,OAAJ,CAAYE,IAAZ,EAAN;AACA,eAAOf,GAAG,CAACgB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAArB,CAAP;AACD;AACF;;AAED,WAAOjB,GAAG,CAACgB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAArB,CAAP;AACD;;AACD,SAAOjB,GAAG,CAACgB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAArB,CAAP;AACD,CAnB2B,EAoB5B;AACEC,EAAAA,UAAU,EAAE,OADd;AAEEC,EAAAA,aAAa,EAAE;AACbC,IAAAA,MAAM,EAAE,QAAwC,IAAxC,GAA+C;AAD1C,GAFjB;AAKEb,EAAAA,QAAQ,EAAEc,OAAO,CAACC,GAAR,CAAYC;AALxB,CApB4B,CAA9B","sourcesContent":["import { withIronSession } from \"next-iron-session\";\nimport data from \"../../data\";\n\nexport default withIronSession(\n  async (req, res) => {\n    console.log(\"sessions hit\")\n    if (req.method === \"POST\") {\n      const users = await data.readTable(\"Users\")\n      const { email, password } = req.body;\n\n      for (let i = 0; i < users.length; i++) {\n        if (users[i].email === email && users[i].passHash === password) {\n          const fName = users[i].fName\n          req.session.set(\"user\", { email, fName });\n          await req.session.save();\n          return res.status(201).send(\"\");\n        }\n      }\n\n      return res.status(403).send(\"\");\n    }\n    return res.status(404).send(\"\");\n  },\n  {\n    cookieName: \"LOGIN\",\n    cookieOptions: {\n      secure: process.env.NODE_ENV === \"production\" ? true : false\n    },\n    password: process.env.APPLICATION_SECRET\n  }\n);\n"]},"metadata":{},"sourceType":"module"}